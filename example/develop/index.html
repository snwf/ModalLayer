<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Example</title>
  <link rel="stylesheet" href="../../src/css/animation.css">
  <link rel="stylesheet" href="../../src/css/core.css">
  <link rel="stylesheet" href="../../src/css/skin/default.css">
  <script src="../../static/fontawesome-free-5.14.0/js/all.min.js"></script>
  <script src="../../static/mathjs-7.5.1/math.js"></script>
  <script src="../../src/js/core/env.js"></script>
  <script src="../../src/js/core/event.js"></script>
  <script src="../../src/js/core/option.js"></script>
  <script src="../../src/js/core/enum.js"></script>
  <script src="../../src/js/core/struct.js"></script>
  <script src="../../src/js/core/core.js"></script>

  <script src="../../src/js/layer/page.js"></script>
  <script src="../../src/js/layer/alert.js"></script>
  <script src="../../src/js/layer/image.js"></script>
  <script src="../../src/js/layer/prompt.js"></script>
  <script src="../../src/js/layer/confirm.js"></script>
  <script src="../../src/js/layer/message.js"></script>
  <script src="../../src/js/layer/loading.js"></script>
  <script src="../../src/js/layer/tips.js"></script>

  <script src="../../src/js/assistant/cache.js"></script>
  <script src="../../src/js/assistant/event.js"></script>
  <script src="../../src/js/assistant/formula.js"></script>
  <script src="../../src/js/assistant/performance.js"></script>
  <script src="../../src/js/assistant/object.js"></script>
  <script src="../../src/js/assistant/element.js"></script>
  <script src="../../src/js/assistant/string.js"></script>
  <script src="../../src/js/assistant/storage.js"></script>
  <script src="../../src/js/assistant/canvas.js"></script>
  <script src="../../src/js/assistant/canvas-filter.js"></script>
  <script src="../../src/js/assistant/canvas-animation.js"></script>
  <script src="../../src/js/assistant/file.js"></script>
  <script src="../../src/js/assistant/number.js"></script>
  <script src="../../src/js/assistant/css.js"></script>
  <script src="../../src/js/assistant/worker.js"></script>

  <script src="../../src/js/worker/canvas-filter.js"></script>
  
  <script src="../../src/js/storage/abstract.js"></script>
  <script src="../../src/js/storage/sync-storage.js"></script>
  <style>
    main {
      position: relative;
    }
    #test-button-container {
      width: 160px;
      margin: 900px auto;
      text-align: center;
    }
    #test-button-container button {
      width: 145px;
      margin: 5px 0px;
      padding: 10px 0px;
    }
    #test-box {
      top: 0px;
      left: 0px;
      width: 500px;
      height: 500px;
      position: absolute;
    }
  </style>
</head>
<body>
  <!-- <img id="img" src="./01.jpg" width="500" alt="" style="display: none;"> -->
  <!-- <canvas id="border" width="480" height="360" style="margin: 50px"></canvas> -->
  <main>
    <div id="test-button-container">
      <button id="loading-button" type="button">测试loading</button>
      <button id="msg-button" type="button">测试msg</button>
      <button id="alert-button" type="button">测试alert</button>
      <button id="confirm-button" type="button">测试confirm</button>
      <button id="prompt-button" type="button">测试prompt</button>
      <button id="page-button-1" type="button">测试page</button>
      <button id="page-button-2" type="button">测试page</button>
      <button id="tips" type="button">测试tips</button>
      <button id="image-button" type="button">测试image</button>
      <button id="delete-all-ModalLayer">删除所有模态层</button>
      <button id="delete-all-cache">清空所有缓存(ModalLayer产生的)</button>
      <input type="file" accept="image/*" id="image-layer-test-input" style="display: none;">
    </div>
    <div id="test-box"></div>
  </main>
  <div>1</div>
</body>
<script>
  // 绘制边框
  // let oCas = document.querySelector('#border');
  // let oCtx = oCas.getContext('2d');
  // let cropBorderSize = 5;

  // ModalLayer['_assistant']['canvas']['drawCropBorder'](oCtx, cropBorderSize * 6, cropBorderSize, 'white');
  // ModalLayer['_assistant']['canvas']['drawRect'](oCtx, cropBorderSize * 2 - cropBorderSize / 2, cropBorderSize * 2 - cropBorderSize / 2, oCas.width - cropBorderSize * 3, oCas.height - cropBorderSize * 3, cropBorderSize, 'white', [0]);
  // ModalLayer['_assistant']['canvas']['drawCropGrid'](oCtx, cropBorderSize * 2, cropBorderSize * 2, oCas.width - cropBorderSize * 2, oCas.height - cropBorderSize * 2, 2, 'white', 'quarter');
</script>
<script>
  // 测试loading
  document.querySelector('#loading-button').onclick = function () {
    let option = {
      popupTime: 5,
      layer: {
        icon: 0,
        duration: 1,
        rate: 'ease',
      },
      window: '#test-box',
    };

    ModalLayer.loading(option, e => {
      console.error(e);
    });
  }

  // 测试msg
  document.querySelector('#msg-button').onclick = function () {
    let option = {
      popupTime: 0,
      window: 'main',
      transition: {
        duration: .5,
        easing: 'linear',
        animation: [{opacity: 0},{opacity: 1}],
      },
      hook: {
        initStart: function () {
          // 检查之前老旧实例如果存在则销毁
          if (document.querySelector('#modal-layer-container'))
            ModalLayer.removeAll();
        }
      },
      progress: {
        enable: true,
        color: 'red',
        position: 'top',
      },
      content: '<i class="fas fa-check" style="color: deepskyblue"></i>点击遮罩层自动消失!',
    };

    ModalLayer.msg(option, function (error) {
      console.error(error);
    });
    // ModalLayer.msg('测试一下', function (error) {
    //   console.error(error);
    // });
  }

  // 测试alert
  document.querySelector('#alert-button').onclick = function () {
    let option = {
      popupTime: 0,
      window: 'main',
      title: '测试喜喜',
      hook: {
        initStart: function () {
          // 检查之前老旧实例如果存在则销毁
          if (document.querySelector('.modal-layer-container'))
            ModalLayer.removeAll();
        }
      },
      drag: {
        enable: true,
        overflow: false
      },
      content: '<i class="fas fa-check" style="color: deepskyblue"></i> 点击遮罩层自动消失!',
    };

    ModalLayer.alert(option, e => console.error(e));
  }
  // 测试confirm
  document.querySelector('#confirm-button').onclick = function () {
    let option = {
      title: '测试',
      popupTime: 0,
      hook: {
        initStart: function () {
          // 检查之前老旧实例如果存在则销毁
          if (document.querySelector('.modal-layer-container'))
            ModalLayer.removeAll();
        }
      },
      event: {interaction: []},
      interaction: [{text: '妥妥儿的!', alias: 'modal-layer-interaction-btn-ok'}, {text: '你在说个锤子?', alias: 'modal-layer-interaction-btn-no'}],
      progress: {
        enable: true,
        position: 'left',
      },
      content: 'php是世界上最好的语言！',
    };

    option.event.interaction[0] = function () {
      void this.hide();
      ModalLayer.alert({
        popupTime: 0,
        parentModalLayer: this,
        text: {
          interaction: {
            ok: '确定'
          }
        },
        event: {
          interaction: {
            ok: function () {
              void this.remove();
            }
          }
        },
        content: '<i class="fas fa-check-circle" style="color: green"></i> 小伙子很有眼光嘛!'
      });
    };

    option.event.interaction[1] = function () {
      ModalLayer.alert({
        content: '<i class="fas fa-window-close" style="color: red"></i> More Confidence!!<br>你再骂！(五秒后自动关闭该窗口)'
      });
    };

    ModalLayer.confirm(option, e => console.error(e));
  }

  // 测试prompt
  document.querySelector('#prompt-button').onclick = function () {
    let option = {
      title: '测试',
      popupTime: 0,
      hook: {
        initStart: function () {
          // 检查之前老旧实例如果存在则销毁
          if (document.querySelector('.modal-layer-container'))
            ModalLayer.removeAll();
        }
      },
      progress: {
        enable: true,
        color: 'red',
        position: 'right',
      },
      content: '<input type="text" style="width: calc(100% - 2px); height: 24px; font-size: 16px; color: red;" placeholder="输入内容进行测试">',
      event : {
        interaction: [
          function () {
            this.hide();
            ModalLayer.alert({
              parentModalLayer: this,
              content: '<i class="fas fa-check-circle" style="color: green"></i> 提交成功!<br>你提交的数据为: ' + this.variable.nodes.container.querySelector('input').value
            });
          }
        ]
      }
    };

    ModalLayer.prompt(option, e => console.error(e));
  }


  // 测试Page
  document.querySelector('#page-button-1').onclick = function () {
    let option = {
      mask: {
        enable: false
      },
      title: '测试测试',
      popupTime: 0,
      content: {
        fullContainer: false
      },
      layer: {
        src: 'https://baidu.com',
      }
    };
    ModalLayer.page(option, e => console.error(e));
  }
  document.querySelector('#page-button-2').onclick = function () {
    let option = {
      mask: true,
      position: 'rt',
      title: '测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试',
      popupTime: 0,
      content: {
        fullContainer: true
      },
      layer: {
        scrolling: 'yes',
        src: 'https://www.hao123.com/',
      }
    };
    ModalLayer.page(option, e => console.error(e));
  }

  // 测试Image
  document.querySelector('#image-button').addEventListener('click', function () {
    // 方式一
    let option = {
      title: '测试',
      mask: true,
      popupTime: 0,
      content: {
        fullContainer: true
      },
      layer: {
        sizeRange: {
          min: [316, 396]
        },
        image: ['asd.jpg', './test.png'],
        toolbar: {
          enable: true,
          config: {
            'crop': {
              'enable': true,
              'title': '裁剪'
            },
            'spin': true,
            'filter': {
              enable: true,
              config: {
                blur: {
                  enable: true,
                  title: 'blur',
                  icon: null,
                  textIcon: '模'
                },
                gray: {
                  enable: true,
                  title: 'gray',
                  icon: null,
                  textIcon: '灰'
                },
                mirror: {
                  enable: true,
                  title: 'mirror',
                  icon: null,
                  textIcon: '镜'
                }
              }
            },
            'revert': true,
            'download': true,
          }
        }
      }
    };
    // ModalLayer.image(option, function (e) {
    //   console.error(e);
    // });

    // 方式二
    let inputNode = document.querySelector('#image-layer-test-input');
    inputNode.onchange = function () {
      option.layer.image = inputNode.files;
      ModalLayer.image(option, function (e) {
        console.error(e);
      });
    }
    inputNode.click();
  });

  // 移除所有ModalLayer实例
  document.querySelector('#delete-all-ModalLayer').onclick = function () {
    ModalLayer._instance.forEach(v => void v.delete());
  }

  // 清空所有缓存数据
  document.querySelector('#delete-all-cache').onclick = function () {
    ModalLayer._assistant.cache.clear();
  }

// let testOption = {
//   title: '测试',
//   mask: true,
//   popupTime: 0,
//   content: {
//     fullContainer: true
//   },
//   layer: {
//     sizeRange: {
//       min: [316, 396]
//     },
//     image: ['asd.jpg', './test.png'],
//     toolbar: {
//       enable: true,
//       config: {
//         'crop': {
//           'enable': true,
//           'title': '裁剪'
//         },
//         'spin': true,
//         'filter': {
//           enable: true,
//           config: {
//             blur: {
//               enable: true,
//               title: 'blur',
//               icon: null,
//               textIcon: '模'
//             },
//             gray: {
//               enable: true,
//               title: 'gray',
//               icon: null,
//               textIcon: '灰'
//             },
//             mirror: {
//               enable: true,
//               title: 'mirror',
//               icon: null,
//               textIcon: '镜'
//             }
//           }
//         },
//         'revert': true,
//         'download': true,
//       }
//     }
//   }
// };
// var per = PerformanceAssistant.functionMeasure(ModalLayer.image, [testOption], 30);
// var report = PerformanceAssistant.getAnalysis(per);
// 测试tips
document.querySelector('#tips').onclick = function () {
    
    let option = {
      popupTime: 5,
      layer:{
        location: '#tips',
        position: 0,
        radius: 15
      },
      progress: {
        enable: true,
        color: 'red',
        position: 'top',
      },
      content: '<span>Hi 我是tips层</span>'
    };
    let option2 = {
      popupTime: 0,
      layer:{
        location: '#tips',
        position: 1,
        radius: 15
      },
      progress: {
        enable: true,
        color: 'red',
        position: 'top',
      },
      content: '<span>Hi asdfasdf</span>'
    };
    ModalLayer.tips(option, function (error) {
    });
    ModalLayer.tips(option2, function (error) {
    });
    // ModalLayer.msg('测试一下', function (error) {
    //   console.error(error);
    // });
  }
</script>
</html>
